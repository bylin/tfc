# luad-survival
_Last modified `r format(Sys.time(), "%I:%M %p on %b %d, %Y")`. This document, R session image, knitr cache, figures, and other associated datasets are located in `cruncher:/inside/grotto/blin/trna-markers/luad/luad-survival/`._

```{r setup, echo=FALSE, warning=FALSE, results=FALSE, message=FALSE, errors=FALSE, cache=FALSE}
library(knitr)
opts_chunk$set(cache = TRUE, cache.path = "/inside/grotto/blin/trna-markers/luad/luad-survival/cache/", eval = TRUE, echo = TRUE, warning = FALSE, results = FALSE, message = FALSE, autodep = TRUE, dev = "png", dpi = 300)
```

```{r libraries, cache=FALSE}
library(survival)
library(glmnet)
library(kable)
source('/inside/home/blin/lib/R/ggsurv.R')
source('/inside/grotto/blin/trna-markers/luad/predict/predict.R')
load('/inside/home/blin/grotto/data/hg19-srnas.RData')
load('/inside/home/blin/grotto/trna-markers/process-reads/luad-counts.RData')
luad_clinical = luad_clinical[match(colnames(luad_adjusted_counts), luad_clinical$barcode), ]
```

## Univariate survival analysis for clinical covariates

First, we'll independently test each covariate and feature to see what is implicated in survival.

### Subtype

```{r univariate-subtype}
km_metadata = na.omit(luad_clinical[luad_clinical$sample_type != "NT" & luad_clinical$days_survived > 30 & luad_clinical$days_survived < 3000, ]) # get rid of NAs, remove normal samples (e.g. duplicates), and put the time period as 1 month - 8 years
load('/inside/grotto/blin/trna-markers/luad/cluster-subtypes/clusters.RData')
clusters = clusters[clusters$known, ]
metadata = km_metadata[substr(km_metadata$barcode, 1, 12) %in% clusters$barcode, ]
metadata$subtype = as.factor(clusters$subtype[match(substr(metadata$barcode, 1, 12), clusters$barcode)])
ggsurv(survfit(Surv(days_survived, vital_status) ~ subtype, data = metadata)) + theme_bw() + ggtitle("Kaplan-Meier plot grouped by subtype")
cox = coxph(Surv(days_survived, vital_status) ~ subtype, data = metadata)
summary(cox)
```

### Tumor stage

```{r univariate-stage}
metadata = km_metadata[km_metadata$stage != "[Not Available]", ]
levels(metadata$stage) = list(I = c("Stage I", "Stage IA", "Stage IB"), II = c("Stage II", "Stage IIA", "Stage IIB"), III = c("Stage III", "Stage IIIA", "Stage IIIB"), IV = "Stage IV")
km = survfit(Surv(days_survived, vital_status) ~ stage, data = metadata)
ggsurv(km) + theme_bw() + ggtitle("Kaplan-Meier plot grouped by stage")
cox = coxph(Surv(days_survived, vital_status) ~ stage, data = metadata)
summary(cox)
```

### Smoker vs non-smoker

```{r univariate-smoking}
km = survfit(Surv(days_survived, vital_status) ~ smoker, data = km_metadata)
ggsurv(km) + theme_bw() + ggtitle("Kaplan-Meier plot grouped by smoking history")
cox = coxph(Surv(days_survived, vital_status) ~ smoker, data = metadata)
summary(cox)
```

### Gender

```{r univariate-gender}
km = survfit(Surv(days_survived, vital_status) ~ gender, data = km_metadata)
ggsurv(km) + theme_bw() + ggtitle("Kaplan-Meier plot grouped by gender")
cox = coxph(Surv(days_survived, vital_status) ~ gender, data = metadata)
summary(cox)
```

### Age

```{r univariate-age}
metadata = km_metadata
metadata$age = ifelse(metadata$age <= 65, "<= 65", "> 65")
km = survfit(Surv(days_survived, vital_status) ~ age, data = metadata)
ggsurv(km) + theme_bw() + ggtitle("Kaplan-Meier plot grouped by age group")
cox = coxph(Surv(days_survived, vital_status) ~ age, data = metadata)
summary(cox)
```



```{r save-image, cache=FALSE}
save.session("luad-survival.RSession")
```
